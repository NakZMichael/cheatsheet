# Clean Architecture の実践 ~ 小売店のレジシステムを作ってみる　~

クリーンアーキテクチャというと以下の図が有名である

![クリーンアーキテクチャの円](./docs/CleanArchitecture.jpeg)

[クリーンアーキテクチャ(The Clean Architecture翻訳)](https://blog.tai2.net/the_clean_architecture.html)より引用

今回はこのアーキテクチャの基本に沿って実装してみる。

## システムの概要

クリーンアーキテクチャではドメイン固有のビジネスロジック(Enterprise Business Rules)とアプリケーション固有のルール(Application Business Rules)とアプリケーション固有のロジックとデータベースやデバイスなど環境に左右されるものを繋ぐレイヤー(Interface Adapters)とデータベースドライバやWebフレームワークなどを構成する(Framework & Driver)の4つのレイヤーに分割する手法が主流である。
その本質は上位3レイヤーを様々なプラットホームや言語に移植しやすくできる点にあるように思う。
Webフレームワークやデータベースドライバやファイルシステムなどは環境によって変化しがちだが上位3レイヤーのロジックそのものは変化させずに移植することが可能な場合がいくらかあるように思う。(オンプレミスのファイルシステムからAWSのS3に切り替える時などにビジネスロジックやユースケースのレイヤーのコードを変更させずに済ませたい。)

そういうわけなのでロジックの少ないアプリケーションにはあまり向いていないアーキテクチャであると思う。
実際に、後から書いていくようにフレームワークやデータベースへの依存を減らすためにかなりコード量が増えるからだ。

したがって簡単なTODOアプリではなく、もう少しだけ複雑にして小売店で注文を受けてから、注文を記録し、商品の合計金額とお釣りを計算するアプリを作成する。
また、注文の打ち間違いやキャンセルなども発生すると思われるので記録から削除する機能も作成する。

技術的な詳細についてだがTypeScript,Express,TypeORMを使用して実装していく。

## ディレクトリの分け方

クリーンアーキテクチャの円は先ほどのべた4つの円で構成されている。
また、円をまたぐ時には外側から内側へのアクセスのみが許されている。
つまり、内側のレイヤーは外側のレイヤーの関数やクラスをインポートしてはならない。
例えば、ビジネスロジックのレイヤーはデータベースは何を使っているだとか、REST APIなのかGraphQLなのかなどという詳細を知っていてはならないのである。

ということで以下のコマンドをプロジェクトのルートディレクトリで実行する。

```
mkdir ./src/enterprise-rules
mkdir ./src/application-rules
mkdir ./src/interface-adapter
mkdir ./src/frameworks
```
